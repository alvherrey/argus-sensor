# Telegraf Configuration for Argus InfluxDB Pipeline
# This config reads CSV output from the Argus pipeline
#
# IMPORTANT: Update the pipe path below with your absolute installation path
# Example: /home/user/argus-sensor/argus-data/argus-telegraf.pipe

[[inputs.tail]]
  # Read from named pipe created by entrypoint.sh
  # MUST be an absolute path in the host where Telegraf runs.
  # Example:
  # files = ["/Users/alvaro/Development/lab/argus-sensor/argus-data/argus-telegraf.pipe"]
  files = ["/ABSOLUTE/PATH/TO/argus-sensor/argus-data/argus-telegraf.pipe"]
  
  # CSV parser
  data_format = "csv"
  csv_header_row_count = 0
  csv_column_names = [
    "stime",
    "saddr", 
    "daddr",
    "proto",
    "sport",
    "dport",
    "sco",    # source country code
    "dco",    # dest country code
    "sas",    # source ASN
    "das",    # dest ASN
    "spkts",
    "dpkts",
    "sbytes",
    "dbytes",
    "dur"
  ]
  # Con -u flag: stime es unix seconds (float)
  # Con -n flag: sport, dport son números, sas, das son números
  csv_column_types = [
    "float",   # stime (unix timestamp con -u)
    "string",  # saddr
    "string",  # daddr
    "string",  # proto
    "string",  # sport (puede ser nombre de servicio sin -n, usar string seguro)
    "string",  # dport (puede ser nombre de servicio sin -n, usar string seguro)
    "string",  # sco
    "string",  # dco
    "string",  # sas (puede ser nombre de ASN sin -n, usar string seguro)
    "string",  # das (puede ser nombre de ASN sin -n, usar string seguro)
    "int",     # spkts
    "int",     # dpkts
    "int",     # sbytes
    "int",     # dbytes
    "float"    # dur
  ]
  csv_skip_rows = 0
  csv_trim_space = true
  
  # Timestamp configuration
  csv_timestamp_column = "stime"
  csv_timestamp_format = "unix"
  
  # Measurement name
  name_override = "argus_flows"
  
  # Tags (for better querying)
  [inputs.tail.tags]
    source = "argus-sensor"

[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]
  token = "${INFLUXDB_TOKEN}"
  organization = "${INFLUXDB_ORG}"
  bucket = "${INFLUXDB_BUCKET}"
  
  # Optional: reduce precision to match rabins aggregation
  precision = "1s"
