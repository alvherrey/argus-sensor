services:
  argus:
    build: .
    image: argus:latest
    container_name: argus
    network_mode: host
    cap_add:
      - NET_RAW
      - NET_ADMIN
    security_opt:
      - apparmor:unconfined
    init: true
    stop_signal: SIGINT
    stop_grace_period: 5s
    restart: "no"
    volumes:
      - ./argus-data:/var/log/argus
      - ./argus.conf:/etc/argus.conf:ro
      - ./radium.conf:/etc/radium.conf:ro
      - ./pcap:/pcap:ro
    environment:
      - INTERFACE=${INTERFACE:-any}
      - PORT=${PORT:-562}
      - SENSOR_PORT=${SENSOR_PORT:-561}
    healthcheck:
      test: ["CMD-SHELL", "bash -lc 'exec 3<>/dev/tcp/127.0.0.1/562'"]
      interval: 30s
      timeout: 3s
      retries: 5
      start_period: 20s
